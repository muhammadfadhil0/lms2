<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Delete Modal - New Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">Test Delete Modal - New Style</h1>
        
        <!-- Sample Post -->
        <div class="bg-white rounded-lg shadow-sm mb-6" data-post-id="123">
            <div class="p-4 lg:p-6">
                <div class="flex items-start space-x-3 lg:space-x-4 mb-4">
                    <div class="w-10 h-10 lg:w-12 lg:h-12 rounded-full bg-orange-500 flex items-center justify-center">
                        <span class="text-white text-sm">üë§</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="font-semibold text-gray-900 text-sm lg:text-base">John Doe</h3>
                        <p class="text-xs lg:text-sm text-gray-600">
                            Guru ‚Ä¢ 2 jam yang lalu
                        </p>
                    </div>
                    <div class="dropdown relative">
                        <button class="text-gray-400 hover:text-gray-600" onclick="toggleDropdown(this)">
                            <span>‚ãØ</span>
                        </button>
                        <div class="dropdown-menu absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10 hidden">
                            <button onclick="editPost(123)" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                ‚úè Edit
                            </button>
                            <button onclick="deletePost(123)" class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100">
                                üóë Hapus
                            </button>
                        </div>
                    </div>
                </div>
                <div class="mb-4">
                    <p class="text-gray-800 text-sm lg:text-base whitespace-pre-wrap">Ini adalah contoh postingan untuk testing modal delete dengan style baru seperti modal help login.</p>
                </div>
                <div class="flex items-center justify-between pt-4 border-t border-gray-100">
                    <div class="flex items-center space-x-4 lg:space-x-6">
                        <button class="flex items-center text-gray-600 hover:text-orange transition-colors text-sm lg:text-base">
                            ‚ô° <span class="ml-1">5</span>
                        </button>
                        <button class="flex items-center text-gray-600 hover:text-orange transition-colors text-sm lg:text-base">
                            üí¨ <span class="ml-1">3</span>
                        </button>
                        <button class="flex items-center text-gray-600 hover:text-orange transition-colors text-sm lg:text-base">
                            ‚Üó <span class="ml-1 hidden sm:inline">Bagikan</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <button onclick="testModal()" class="bg-blue-500 text-white px-4 py-2 rounded">Test Modal</button>
    </div>

    <!-- Modal Delete Post - New Style like modal-help-login.php -->
    <dialog id="deletePostModal" aria-labelledby="delete-dialog-title" class="fixed inset-0 size-auto max-h-none max-w-none overflow-y-auto bg-transparent backdrop:bg-transparent">
        <div class="fixed inset-0 bg-gray-500/75 transition-opacity"></div>

        <div tabindex="0" class="flex min-h-full items-end justify-center p-4 text-center focus:outline-none sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex size-12 shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:size-10">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-red-600" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="m0 0h24v24H0z" fill="none" />
                                <path d="m4 7l16 0" />
                                <path d="m10 11l0 6" />
                                <path d="m14 11l0 6" />
                                <path d="m5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" />
                                <path d="m9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
                            </svg>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 id="delete-dialog-title" class="text-base font-semibold text-gray-900">Hapus Postingan</h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500">Apakah Anda yakin ingin menghapus postingan ini? Tindakan ini tidak dapat dibatalkan dan semua data terkait akan ikut terhapus.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                    <button id="confirmDeleteBtn" type="button" class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-red-500 sm:ml-3 sm:w-auto items-center disabled:opacity-50 disabled:cursor-not-allowed">
                        <span class="delete-btn-text">Hapus</span>
                        <svg class="w-4 h-4 ml-2 animate-spin hidden delete-btn-loading" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="m0 0h24v24H0z" fill="none" />
                            <path d="m12 3a9 9 0 1 0 9 9" />
                        </svg>
                    </button>
                    <button id="cancelDeleteBtn" type="button" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-xs ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">
                        Batal
                    </button>
                </div>
                <div class="px-4 pb-2 sm:px-6">
                    <p class="text-center text-xs text-gray-400">Klik atau sentuh mana saja untuk menutup</p>
                </div>
            </div>
        </div>
    </dialog>

    <script>
        // Mock KelasPosting class for testing
        class KelasPosting {
            constructor() {
                this.postToDelete = null;
                this.initializeDeleteModal();
            }
            
            initializeDeleteModal() {
                const modal = document.getElementById('deletePostModal');
                const cancelBtn = document.getElementById('cancelDeleteBtn');
                const confirmBtn = document.getElementById('confirmDeleteBtn');
                
                if (modal && cancelBtn && confirmBtn) {
                    // Cancel delete
                    cancelBtn.addEventListener('click', () => {
                        this.hideDeleteModal();
                    });
                    
                    // Confirm delete
                    confirmBtn.addEventListener('click', () => {
                        this.confirmDeletePost();
                    });
                    
                    // Close modal when clicking outside (on backdrop)
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            this.hideDeleteModal();
                        }
                    });
                    
                    // Close modal with ESC key
                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape' && modal.hasAttribute('open')) {
                            this.hideDeleteModal();
                        }
                    });
                }
            }
            
            showDeleteModal(postId) {
                this.postToDelete = postId;
                const modal = document.getElementById('deletePostModal');
                if (modal) {
                    modal.showModal();
                }
            }
            
            hideDeleteModal() {
                this.postToDelete = null;
                const modal = document.getElementById('deletePostModal');
                if (modal) {
                    modal.close();
                }
                
                // Reset button state
                const confirmBtn = document.getElementById('confirmDeleteBtn');
                const btnText = confirmBtn?.querySelector('.delete-btn-text');
                const btnLoading = confirmBtn?.querySelector('.delete-btn-loading');
                
                if (btnText && btnLoading) {
                    btnText.classList.remove('hidden');
                    btnLoading.classList.add('hidden');
                    confirmBtn.disabled = false;
                }
            }
            
            async confirmDeletePost() {
                if (!this.postToDelete) return;
                
                const confirmBtn = document.getElementById('confirmDeleteBtn');
                const btnText = confirmBtn?.querySelector('.delete-btn-text');
                const btnLoading = confirmBtn?.querySelector('.delete-btn-loading');
                
                // Show loading state
                if (btnText && btnLoading && confirmBtn) {
                    btnText.classList.add('hidden');
                    btnLoading.classList.remove('hidden');
                    confirmBtn.disabled = true;
                }
                
                // Simulate API call
                setTimeout(() => {
                    console.log('Deleting post:', this.postToDelete);
                    
                    // Close modal first
                    this.hideDeleteModal();
                    
                    // Remove post element from DOM immediately
                    const postContainer = document.querySelector(`[data-post-id="${this.postToDelete}"]`);
                    if (postContainer) {
                        // Add fade out animation
                        postContainer.style.transition = 'all 0.3s ease-out';
                        postContainer.style.opacity = '0';
                        postContainer.style.transform = 'translateY(-20px)';
                        
                        // Remove from DOM after animation
                        setTimeout(() => {
                            if (postContainer.parentNode) {
                                postContainer.remove();
                            }
                        }, 300);
                    }
                    
                    alert('Postingan berhasil dihapus!');
                }, 1000);
            }
        }
        
        // Initialize
        window.kelasPosting = new KelasPosting();
        
        // Global functions
        function deletePost(postId) {
            if (window.kelasPosting) {
                window.kelasPosting.showDeleteModal(postId);
            }
        }
        
        function editPost(postId) {
            alert('Edit post: ' + postId);
        }
        
        function toggleDropdown(button) {
            const dropdown = button.nextElementSibling;
            dropdown.classList.toggle('hidden');
            
            // Close dropdown when clicking outside
            function closeDropdown(e) {
                if (!button.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.classList.add('hidden');
                    document.removeEventListener('click', closeDropdown);
                }
            }
            
            if (!dropdown.classList.contains('hidden')) {
                setTimeout(() => document.addEventListener('click', closeDropdown), 10);
            }
        }
        
        function testModal() {
            deletePost(123);
        }
    </script>
</body>
</html>
